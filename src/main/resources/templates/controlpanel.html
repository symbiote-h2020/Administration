<!DOCTYPE HTML>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Control Panel</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <meta name="_csrf" th:content="${_csrf.token}"/>
    <meta name="_csrf_header" th:content="${_csrf.headerName}"/>

    <link rel='stylesheet' href='/webjars/bootstrap/3.3.7-1/css/bootstrap.min.css'/>
    <link rel="stylesheet" th:href="@{/css/cpanel.css}" href="css/cpanel.css" />
    <link rel="stylesheet" th:href="@{/css/bootstrap-select.min.css}" href="css/bootstrap-select.min.css" />

    <script type="text/javascript" src="/webjars/jquery/3.1.1-1/jquery.min.js"></script>
    <script type="text/javascript" src="/webjars/bootstrap/3.3.7-1/js/bootstrap.min.js"></script>
    <script type="text/javascript" th:src="@{/js/cpanel.js}" src="js/cpanel.js"></script>
    <script type="text/javascript" th:src="@{/js/bootstrap-select.min.js}" src="js/bootstrap-select.min.js"></script>
    <script type="text/javascript" th:src="@{/js/validator.js}" src="js/validator.js"></script>

</head>
<body>

<div class="header shadow">
    <div class="container">
        <img class="logo" th:src="@{/images/logo-1.1.png}" src="static/images/logo-1.1.png"></img>
        <span class="title">User Dashboard</span>
        <div class="btn-group logout">

            <button class="btn top" th:inline="text">[[${user.getUsername()}]]</button>
            <button data-toggle="dropdown" class="btn dropdown-toggle">
                <span class="caret"></span>
            </button>
            <ul class="dropdown-menu dropdown-menu-right">
                <li class="disabled">
                    <a href="#">Account Details</a>
                </li>
                <li class="divider">
                </li>
                <li >
                    <a href="/user/logout">Sign Out</a>
                </li>
            </ul>
        </div>
    </div>
</div>
<div class="main">
    <div class="container tabbable">
        <div class="row">
            <div class="col-md-3">
                <ul class="nav nav-pills nav-stacked sidebar panel-primary shadow">
                    <!--<ul class="nav nav-stacked sidebar panel-primary shadow">-->

                    <li th:classappend="${activeTab}?:active">
                        <a href="#user_details" data-toggle="tab">User Details</a>
                    </li>
                    <li th:classappend="${activeTab == 'clients_details'}?active">
                        <a href="#clients_details" data-toggle="tab">Client Details</a>
                    </li>
                    <li th:if="${user.role == T(eu.h2020.symbiote.security.commons.enums.UserRole).PLATFORM_OWNER}"
                        th:classappend="${activeTab == 'platform_details'}?active">
                        <a href="#platform_details" data-toggle="tab">Platform Details</a>
                    </li>
                    <li th:if="${user.role == T(eu.h2020.symbiote.security.commons.enums.UserRole).PLATFORM_OWNER}"
                        th:classappend="${activeTab == 'information_models'}?active">
                        <a href="#information_models" data-toggle="tab">Information Models</a>
                    </li>
                </ul>
            </div>

            <div class="tab-content clearfix col-md-9">

                <!-- User Details Tab-->
                <div class="tab-pane" id="user_details" th:classappend="${activeTab}?:active">
                    <h3>User Details</h3>
                </div>

                <!-- Client Details Tab-->
                <div class="tab-pane" id="clients_details" th:classappend="${activeTab == 'clients_details'}?active">
                    <h3>Client Details</h3>
                </div>

                <!-- Platform Details Tab-->
                <div class="tab-pane" id="platform_details" th:classappend="${activeTab == 'platform_details'}?active">
                    <h3>Platform Details</h3>

                    <!-- Display errors -->
                    <div class="alert alert-danger alert-dismissable" th:if="${ownedPlatformDetailsError}">
                        <a href="#" class="close" data-dismiss="alert" aria-label="close">&times;</a>
                        <strong>Error!</strong>
                        <p th:text="${ownedPlatformDetailsError}"></p></div>
                    <div class="alert alert-danger alert-dismissable" th:if="${communicationException}">
                        <a href="#" class="close" data-dismiss="alert" aria-label="close">&times;</a>
                        <strong>Error!</strong>
                        <p th:text="${communicationException}"></p></div>
                    <div class="alert alert-danger alert-dismissable" th:if="${platformDeleteError}">
                        <a href="#" class="close" data-dismiss="alert" aria-label="close">&times;</a>
                        <strong>Error!</strong>
                        <p th:text="${platformDeleteError}"></p></div>

                    <!-- Display success message -->
                    <div class="alert alert-success alert-dismissable" th:if="${platformRegistrationSuccessful}">
                        <a href="#" class="close" data-dismiss="alert" aria-label="close">&times;</a>
                        <strong>Success!</strong>
                        <p th:text="${platformRegistrationSuccessful}"></p></div>
                    <div class="alert alert-success alert-dismissable" th:if="${platformDeleted}">
                        <a href="#" class="close" data-dismiss="alert" aria-label="close">&times;</a>
                        <strong>Success!</strong>
                        <p th:text="${platformDeleted}"></p></div>

                    <!-- Register new Platform by triggering the button-->
                    <!-- Trigger the modal with a button -->
                    <button type="button" class="btn btn-info btn-default registrationBtn" data-toggle="modal"
                            data-target="#platformRegistrationModal">Register New Platform</button>

                    <!-- If there is an error during platform registration use this input field to notify the javascript
                    to keep the modal open -->
                    <input type="hidden" id="platformRegistrationError" th:if="${platformRegistrationError}" />

                    <!-- Modal -->
                    <div id="platformRegistrationModal" class="modal fade" role="dialog">
                        <div class="modal-dialog">

                            <!-- Modal content-->
                            <div class="modal-content">
                                <form id="platformRegFrom" th:action="@{/user/cpanel/register_platform}"
                                      th:object="${platformDetails}" role="form" method="post"
                                      data-toggle="validator">

                                    <div class="modal-header">
                                        <button type="button" class="close" data-dismiss="modal">&times;</button>
                                        <h3 class="modal-title">Platform Registration</h3></div>

                                    <div class="modal-body">

                                        <!-- Display errors -->
                                        <div class="alert alert-danger alert-dismissable" th:if="${infoModelListError}">
                                            <a href="#" class="close" data-dismiss="alert" aria-label="close">&times;</a>
                                            <strong>Error!</strong>
                                            <p th:text="${infoModelListError}"></p></div>
                                        <div class="alert alert-danger alert-dismissable" th:if="${aamPlatformRegistrationError}">
                                            <a href="#" class="close" data-dismiss="alert" aria-label="close">&times;</a>
                                            <strong>Error!</strong>
                                            <p th:text="${aamPlatformRegistrationError}"></p></div>
                                        <div class="alert alert-danger alert-dismissable" th:if="${registryPlatformRegistrationError}">
                                            <a href="#" class="close" data-dismiss="alert" aria-label="close">&times;</a>
                                            <strong>Error!</strong>
                                            <p th:text="${registryPlatformRegistrationError}"></p></div>

                                        <!-- Registration Form -->
                                        <div class="row">
                                            <div class="col-sm-12">
                                                <div class="row">
                                                    <div class="col-sm-6 form-group has-feedback">
                                                        <label>Platform Id</label>
                                                        <input type="text" class="form-control platformRegField" maxlength="30"
                                                               id="id" name="id" placeholder="Enter the preferred platform id"
                                                               pattern="^[\w-][\w-][\w-][\w-]+" data-pattern-error="From 4 to 30 characters.
                                                               Include only letters, digits, '-' and '_'. You can leave it empty for autogeneration"
                                                               th:value="${insertedPlatformDetails == null or insertedPlatformDetails.id == null}?'':${insertedPlatformDetails.id}"/>
                                                        <span class="glyphicon form-control-feedback" aria-hidden="true"></span>
                                                        <div class="help-block with-errors">From 4 to 30 characters. Include only letters, digits, '-' and '_'. You can leave it
                                                            empty for autogeneration</div>
                                                        <div class="alert alert-danger" th:if="${pl_reg_error_id}">
                                                            Up to 30 characters. Only letters, digits, '-' and '_' are permitted. Or leave it
                                                            empty for autogeneration</div>
                                                    </div>
                                                    <div class="col-sm-6 form-group has-feedback">
                                                        <label>Platform Name</label>
                                                        <input type="text"  class="form-control platformRegField"
                                                               id="name" name="name" placeholder="Enter the platform name"
                                                               th:value="${insertedPlatformDetails == null or insertedPlatformDetails.name == null}?'':${insertedPlatformDetails.name}"
                                                               minlength="3" maxlength="30" required="required"
                                                               data-required-error="Platform name is required"/>
                                                        <span class="glyphicon form-control-feedback" aria-hidden="true"></span>
                                                        <div class="help-block with-errors">From 3 to 30 characters</div>
                                                        <div class="alert alert-danger" th:if="${pl_reg_error_name}"
                                                             th:text="${pl_reg_error_name}">Invalid name!</div>
                                                    </div>
                                                </div>
                                                <div class="form-group has-feedback">
                                                    <label>Platform Description</label>
                                                    <textarea  class="form-control platformRegField"
                                                               id="description" name="description" placeholder="Enter the platform description"
                                                               th:inline="text" rows="3" minlength="3"
                                                               maxlength="300" required="required"
                                                               data-required-error="Platform description is required">[[${insertedPlatformDetails == null or insertedPlatformDetails.description == null}?'':${insertedPlatformDetails.description}]]</textarea>
                                                    <span class="glyphicon form-control-feedback" aria-hidden="true"></span>
                                                    <div class="help-block with-errors">From 4 to 30 characters</div>
                                                    <div class="alert alert-danger" th:if="${pl_reg_error_description}"
                                                         th:text="${pl_reg_error_description}">Invalid Description!</div>
                                                </div>
                                                <div class="form-group">
                                                    <label>Labels (Optional)</label>
                                                    <div class="row">
                                                        <div class="col-sm-4 form-group has-feedback">
                                                            <input type="text" class="form-control platformRegField"
                                                                   id="labels[0].label" name="labels[0].label" placeholder="Label"
                                                                   th:value="${insertedPlatformDetails == null or insertedPlatformDetails.labels == null or
                                                                   insertedPlatformDetails.labels[0].label == null}?'':${insertedPlatformDetails.labels[0].label}"
                                                                   minlength="3" maxlength="30"/>
                                                            <span class="glyphicon form-control-feedback sub-element" aria-hidden="true"></span>
                                                            <div class="help-block with-errors">From 3 to 30 characters</div>
                                                            <div class="alert alert-danger" th:if="${pl_reg_error_labels_0_label}"
                                                                 th:text="${pl_reg_error_labels_0_label}">Invalid Label!</div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="form-group">
                                                    <label>Comments (Optional)</label>
                                                    <div class="row">
                                                        <div class="col-sm-12 form-group has-feedback">
                                                            <textarea class="form-control platformRegField"
                                                                      id="comments[0].comment" name="comments[0].comment"
                                                                      placeholder="Enter a comment" rows="1" th:inline="text"
                                                                      minlength="3" maxlength="300">[[${insertedPlatformDetails == null or insertedPlatformDetails.comments == null or
                                                                      insertedPlatformDetails.comments[0].comment == null}?'':${insertedPlatformDetails.comments[0].comment}]]</textarea>
                                                            <span class="glyphicon form-control-feedback sub-element" aria-hidden="true"></span>
                                                            <div class="help-block with-errors">From 4 to 30 characters</div>
                                                            <div class="alert alert-danger" th:if="${pl_reg_error_comments_0_comment}"
                                                                 th:text="${pl_reg_error_comments_0_comment}">Invalid Comment!</div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="form-group">
                                                    <label>Interworking Service</label>
                                                    <div class="row">
                                                        <div class="col-sm-8 form-group has-feedback">
                                                            <input type="url" class="form-control platformRegField"
                                                                   id="interworkingServices[0].url" name= "interworkingServices[0].url" placeholder="Enter a valid https url"
                                                                   th:value="${insertedPlatformDetails == null or insertedPlatformDetails.interworkingServices == null or
                                                                   insertedPlatformDetails.interworkingServices[0].url == null}?'':${insertedPlatformDetails.interworkingServices[0].url}"
                                                                   pattern="^https.*" data-pattern-error="Please enter a valid https url"
                                                                   data-error="Not valid url" required="required" data-required-error="A valid https url is required"/>
                                                            <span class="glyphicon form-control-feedback sub-element" aria-hidden="true"></span>
                                                            <div class="help-block with-errors"></div>
                                                            <div class="alert alert-danger" th:if="${pl_reg_error_interworkingServices_0_url}"
                                                                 th:text="${pl_reg_error_interworkingServices_0_url}">Invalid information url!</div>
                                                        </div>
                                                        <div class="col-sm-4 form-group">
                                                            <div class="platformRegField">
                                                                <select class="selectpicker form-control platformRegField"
                                                                        id="interworkingServices[0].informationModelId"
                                                                        name="interworkingServices[0].informationModelId"
                                                                        data-live-search="true" title="Information Model" required="required"
                                                                        data-required-error="Information model is required">
                                                                    <option th:each="model : ${infoModels}"
                                                                            th:value="${model.id}"
                                                                            th:text="${model.name}"
                                                                            th:selected="${insertedPlatformDetails == null or insertedPlatformDetails.interworkingServices == null or
                                                                            insertedPlatformDetails.interworkingServices[0].informationModelId == null}?false:${model.isSelected(insertedPlatformDetails.interworkingServices[0].informationModelId)}"></option>
                                                                </select>
                                                                <div class="help-block with-errors"></div>
                                                            </div>
                                                            <div class="alert alert-danger" th:if="${pl_reg_error_interworkingServices_0_informationModelId}"
                                                                 th:text="${pl_reg_error_interworkingServices_0_informationModelId}">Invalid information Model!</div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="row form-group">
                                                    <div class="col-sm-4 form-group">
                                                        <label>Type</label>
                                                        <select class="selectpicker form-control platformRegField"
                                                                id="isEnabler" name="isEnabler" required="required"
                                                                data-required-error="Type is required">
                                                            <option th:value="false" th:selected="${insertedPlatformDetails == null or
                                                        insertedPlatformDetails.isEnabler == null || insertedPlatformDetails.isEnabler == false}?true:false">Platform</option>
                                                            <option th:value="true" th:selected="${insertedPlatformDetails == null or
                                                        insertedPlatformDetails.isEnabler == null || insertedPlatformDetails.isEnabler == false}?false:true">Enabler</option>
                                                        </select>
                                                        <div class="help-block with-errors"></div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="modal-footer">
                                        <button type="submit" name="regPlatformBtn" class="btn btn-default btn-info">Submit</button>
                                        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>

                    <!-- Show Platform Details -->
                    <th:block th:each="platform, iter : ${platforms}">
                        <div class="panel panel-primary panelEntry">
                            <div class="panel-heading clickable">
                                <h3 class="panel-title" th:text="${platform.platformInstanceFriendlyName}">
                                    Platform Name
                                </h3>
                                <span class="pull-right"><i class="glyphicon glyphicon-plus"></i></span>
                            </div>
                            <div class="panel-body" th:text="${platform.platformInstanceId}" style="display: none;">
                                Platform Id
                            </div>
                            <div class="panel-footer platform-info-footer">

                                <!-- Trigger the modal with a button -->
                                <button type="button" class="btn btn-default btn-warning btn-warning-delete"
                                        data-toggle="modal" th:attr="data-target='#deletePlatformModal' + ${platform.platformInstanceId}">Delete</button>

                                <!-- Modal -->
                                <div th:id="${'deletePlatformModal' + platform.platformInstanceId}" class="modal fade" role="dialog">
                                    <div class="modal-dialog">

                                        <!-- Modal content-->
                                        <div class="modal-content">
                                            <div class="modal-header">
                                                <button type="button" class="close" data-dismiss="modal">&times;</button>
                                                <h4 class="modal-title">Are you sure you want to delete the platform
                                                    <strong th:inline="text">[[${platform.platformInstanceFriendlyName}]]</strong>?</h4>
                                            </div>
                                            <div class="modal-body">
                                                <h4 class="text-danger">Warning - if you delete this platform, some information may be lost!</h4>
                                                <p>(During release 0.2.1, make sure you have deleted all registered resources)</p>
                                            </div>
                                            <div class="modal-footer">
                                                <form class="list-group-item" th:id="${'platformDelForm' + platform.platformInstanceId}"
                                                      th:action="@{/user/cpanel/delete_platform}"
                                                      role="form" method="post">
                                                    <input type="hidden" name="platformIdToDelete" th:value="${platform.platformInstanceId}"/>
                                                    <button type="submit" class="btn btn-default btn-danger">Verify Deletion</button>
                                                    <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                                                </form>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </th:block>
                </div>

                <!-- Information Model Tab-->
                <div class="tab-pane" id="information_models" th:classappend="${activeTab == 'information_models'}?active">
                    <h3>Information Models</h3>

                    <!-- Display errors -->
                    <div class="alert alert-danger alert-dismissable information-model-list-error" id="information-model-list-error" style="display: none;">
                        <a href="#" class="close" data-dismiss="alert" aria-label="close">&times;</a>
                        <strong>Error!</strong></div>

                    <!-- Register new Information Model by triggering the button-->
                    <!-- Trigger the modal with a button -->
                    <button type="button" class="btn btn-info btn-default registrationBtn" data-toggle="modal"
                            data-target="#infoModelRegModal">Register New Information Model</button>

                    <!-- Modal -->
                    <div id="infoModelRegModal" class="modal fade" role="dialog">
                        <div class="modal-dialog">

                            <!-- Modal content-->
                            <div class="modal-content">
                                <div class="modal-header">
                                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                                    <h3 class="modal-title">Platform Registration</h3>
                                </div>
                                <div class="modal-body">
                                    <div class="row">
                                        <div class="col-sm-12">
                                            <div class="row">
                                                <div class="col-sm-6 form-group">
                                                    <label>Id</label>
                                                    <input type="text" class="form-control" id="infoModelId"
                                                           name="infoModelId" placeholder="Enter the id of the information model" />
                                                </div>
                                                <div class="col-sm-6 form-group">
                                                    <label>Uri</label>
                                                    <input type="text"  class="form-control" id="infoModelUri"
                                                           name="infoModelUri" placeholder="Enter the uri of the information model" />
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-sm-12">
                                            <div class="row">
                                                <div class="col-sm-6 form-group">
                                                    <label>Name</label>
                                                    <input type="text" class="form-control" id="infoModelName"
                                                           name="infoModelName" placeholder="Enter name of the information model" />
                                                </div>
                                                <div class="col-sm-6 form-group">
                                                    <label>Owner</label>
                                                    <input type="text"  class="form-control" id="infoModelOwner"
                                                           name="infoModelOwner" placeholder="Enter the owner of the information model" />
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-sm-12">
                                            <div class="row">
                                                <div class="col-sm-6 form-group">
                                                    <label>Rdf</label>
                                                    <input type="text" class="form-control" id="infoModelRdf"
                                                           name="infoModelRdf" placeholder="Enter rdf of the information model" />
                                                </div>
                                                <div class="col-sm-6 form-group">
                                                    <label>RdfFormat</label>
                                                    <input type="text"  class="form-control" id="infoModelRdfFormat"
                                                           name="infoModelRdfFormat" placeholder="Enter the rdfFormat of the information model" />
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                </div>
                                <div class="modal-footer">
                                    <button type="button" name="infoModelRegBtn" class="btn btn-default btn-info" onclick="registerInfoModel()">Submit</button>
                                    <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                                </div>
                                <!--<form th:action="@{/user/cpanel/register_info_model}" th:object="${informationModel}" role="form" method="post">-->

                                    <!--<div class="modal-header">-->
                                        <!--<button type="button" class="close" data-dismiss="modal">&times;</button>-->
                                        <!--<h3 class="modal-title">Platform Registration</h3>-->
                                    <!--</div>-->
                                    <!--<div class="modal-body">-->
                                        <!--<div class="row">-->
                                            <!--<div class="col-sm-12">-->
                                                <!--<div class="row">-->
                                                    <!--<div class="col-sm-6 form-group">-->
                                                        <!--<label>Name</label>-->
                                                        <!--<input type="text" class="form-control" th:field="*{name}" placeholder="Enter name of the information model" />-->
                                                    <!--</div>-->
                                                    <!--<div class="col-sm-6 form-group">-->
                                                        <!--<label>Owner</label>-->
                                                        <!--<input type="text"  class="form-control" th:field="*{owner}" placeholder="Enter the owner of the information model" />-->
                                                    <!--</div>-->
                                                <!--</div>-->
                                            <!--</div>-->
                                        <!--</div>-->
                                    <!--</div>-->
                                    <!--<div class="modal-footer">-->
                                        <!--<button type="submit" name="infoModelRegBtn" class="btn btn-default btn-info">Submit</button>-->
                                        <!--<button type="button" class="btn btn-default" data-dismiss="modal">Close</button>-->
                                    <!--</div>-->
                                <!--</form>-->
                            </div>
                        </div>
                    </div>

                    <div class="panel panel-primary panelEntry" id="info-model-entry" style="display: none">
                        <div class="panel-heading clickable">
                            <h3 class="panel-title">INFORMATION_MODEL_NAME</h3>
                            <span class="pull-right"><i class="glyphicon glyphicon-plus"></i></span></div>
                        <div class="panel-body" style="display: none;">INFORMATION_MODEL_OWNER</div>
                        <div class="panel-footer platform-info-footer">

                            <!-- Trigger the modal with a button -->
                            <button type="button" class="btn btn-default btn-warning btn-warning-delete"
                                    data-toggle="modal" data-target="#INFO-MODEL-MODAL">Delete</button>

                            <!-- Modal -->
                            <div id="INFO-MODEL-MODAL" class="modal fade" role="dialog">
                                <div class="modal-dialog">

                                    <!-- Modal content-->
                                    <div class="modal-content">
                                        <div class="modal-header">
                                            <button type="button" class="close" data-dismiss="modal">&times;</button>
                                            <h4 class="modal-title text-danger">Are you sure you want to delete the information model
                                                <strong>INFORMATION MODEL NAME</strong>?</h4>
                                        </div>
                                        <div class="modal-footer">
                                            <input type="hidden" name="platformIdToDelete" value="CHANGE THIS"/>
                                            <button type="submit" class="btn btn-default btn-danger">Verify Deletion</button>
                                            <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Show Information Model Details -->
                    <script>buildInfoModelsPanel();</script>

                </div>
            </div>
        </div>
    </div>
</div>

</body>
</html>